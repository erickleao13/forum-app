<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fórum App</title>
    <style>
        /* ... (estilos permanecem os mesmos) ... */
    </style>
</head>
<body>
    <div class="status-bar"></div>
    <div id="app">
        <!-- ... (estrutura HTML permanece a mesma) ... -->
    </div>

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCv3mnPI0wwYIFyGOazhL59U7qOH4BSjMg",
            authDomain: "teste-5d170.firebaseapp.com",
            databaseURL: "https://teste-5d170-default-rtdb.firebaseio.com",
            projectId: "teste-5d170",
            storageBucket: "teste-5d170.appspot.com",
            messagingSenderId: "607632870147",
            appId: "1:607632870147:web:f20542296ab44d3eaab736",
            measurementId: "G-K3K7G42EF6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        console.log("Firebase inicializado");

        // Referência para o nó 'topics' no banco de dados
        const topicsRef = firebase.database().ref('topics');
        console.log("Referência do banco de dados criada:", topicsRef.toString());

        function showScreen(screenId) {
            document.getElementById('main-screen').style.display = 'none';
            document.getElementById('topics-screen').style.display = 'none';
            document.getElementById('new-topic-screen').style.display = 'none';
            document.getElementById(screenId + '-screen').style.display = 'block';

            if (screenId === 'topics') {
                renderTopics();
            }
        }

        function renderTopics() {
            const topicsList = document.getElementById('topics-list');
            topicsList.innerHTML = '';

            console.log("Iniciando leitura de tópicos");
            topicsRef.on('value', (snapshot) => {
                console.log('Dados recebidos:', snapshot.val());
                topicsList.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const topic = childSnapshot.val();
                    const topicElement = document.createElement('div');
                    topicElement.className = 'topic-item';
                    topicElement.innerHTML = `
                        <h3 class="topic-title">${topic.title}</h3>
                        <p class="topic-author">por ${topic.author}</p>
                    `;
                    topicsList.appendChild(topicElement);
                });
            }, (error) => {
                console.error("Erro ao ler tópicos:", error);
            });
        }

        function createTopic() {
            const title = document.getElementById('topic-title').value;
            const content = document.getElementById('topic-content').value;
            if (title && content) {
                const newTopic = {
                    title: title,
                    content: content,
                    author: "Usuário",
                    timestamp: Date.now()
                };
                console.log("Tentando criar novo tópico:", newTopic);
                topicsRef.push(newTopic)
                    .then(() => {
                        console.log('Tópico criado com sucesso!');
                        alert('Tópico criado com sucesso!');
                        document.getElementById('topic-title').value = '';
                        document.getElementById('topic-content').value = '';
                        showScreen('topics');
                    })
                    .catch((error) => {
                        console.error('Erro ao criar tópico:', error);
                        alert('Erro ao criar tópico. Por favor, tente novamente.');
                    });
            } else {
                alert('Por favor, preencha todos os campos.');
            }
        }

        // Inicializa a tela principal
        showScreen('main');

        // Teste de conexão com o Firebase
        firebase.database().ref('.info/connected').on('value', function(snap) {
            if (snap.val() === true) {
                console.log('Conectado ao Firebase');
            } else {
                console.log('Não conectado ao Firebase');
            }
        });
    </script>
</body>
</html>
